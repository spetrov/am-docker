(window.webpackJsonp=window.webpackJsonp||[]).push([[119],{660:function(e,t,n){"use strict";n.r(t);n(89),n(45),n(35),n(19),n(51);var a=n(0),i=n.n(a),s=n(2),r=n.n(s),o=n(379),u=n.n(o),d=n(383),l=n.n(d),c=n(13),f=n.n(c),p=n(384),h=n(3),m=(n(29),n(4)),b=new(n(180).a)("".concat(m.a.context,"/selfservice/"));b.getInfo=function(){return this.serviceCall({url:"kba"})},b.saveInfo=function(e){return this.serviceCall({type:"PATCH",url:"user/".concat(h.a.loggedUser.id),data:JSON.stringify(i()(e).map(function(e,t){return{operation:"replace",field:"/".concat(t),value:e}}))}).then(function(e){return h.a.loggedUser.save(e,{silent:!0})})};var g,v=b,k=n(116),w=n(39);function y(){var e=w.a.getState().local.session.realm;if(e!==g){g=e;var t=Object(k.a)("/selfservice/");v.serviceUrl="".concat(m.a.context,"/json").concat(t),v.baseEntity="json".concat(t)}}y(),w.a.subscribe(y);var C=v,A=n(176),q=p.a.extend({template:"user/UserProfileKBATab",events:i.a.extend({"change .kba-pair :input":"checkChanges","keyup .kba-pair :input":"checkChanges","mouseup .kba-pair select":"checkChanges","click #provideAnother":"addKBAQuestion","click .delete-KBA-question":"deleteKBAQuestion"},p.a.prototype.events),partials:{"profile/_kbaItem":"profile/_kbaItem"},getTabDetail:function(){return{panelId:"userKBATab",label:r.a.t("common.user.kba.securityQuestions")}},addKBAQuestion:function(e){e.preventDefault();var t=this.$el.find("#kbaItems"),n=r()(e.target).closest("form"),a=t.find(">li").length;t.append(r()("<li>").html(f.a.partials["profile/_kbaItem"]({questions:this.data.predefinedQuestions,index:a,isNew:!0}))),A.a.bindValidators(this.$el.find("form"),h.a.loggedUser.baseEntity,i.a.bind(function(){A.a.validateAllFields(this.$el.find("form"))},this)),r()(n).find("input[type='reset']").prop("disabled",!1)},deleteKBAQuestion:function(e){var t=r()(e.target),n=t.closest("form"),a=t.closest(".kba-pair");e.preventDefault(),"true"===a.attr("isNew")?a.parent("li").remove():a.hide(),this.changesPendingWidget.makeChanges({subform:this.getFormContent()}),A.a.bindValidators(n,h.a.loggedUser.baseEntity,function(){A.a.validateAllFields(n)}),r()(n).find("input[type='reset']").prop("disabled",!1)},checkChanges:function(e){var t=r()(e.target),n=t.closest("form"),a=t.closest(".kba-pair"),s=a.find(".answer :input"),o=i.a.keys(u()(e.target))[0],d=this.changesPendingWidget.data.watchedObj.subform[o],l=a.find(".custom-question"),c=t.hasClass("kba-questions"),f=a.find(".kba-questions");l.toggleClass("hidden","custom"!==f.val()),(!d||!d[a.attr("index")]||("custom"===f.val()?d[a.attr("index")].customQuestion!==l.find(":input").val():d[a.attr("index")].questionId!==f.val()))&&(s.attr("data-validator","required"),s.attr("placeholder","")),(!c||c&&""!==t.val())&&A.a.bindValidators(n,h.a.loggedUser.baseEntity,function(){A.a.validateAllFields(n)}),c||this.changesPendingWidget.makeChanges({subform:this.getFormContent()}),r()(n).find("input[type='reset']").prop("disabled",!1)},submit:function(e){C.saveInfo(e).then(i.a.bind(function(){this.submitSuccess()},this))},getFormContent:function(){var e=this,t=this.$el.find("form")[0],n=u()(t,".",!1);return i()(n).map(function(n,a){return i.a.isArray(n)?[a,i()(n).map(function(n,s){var o={};if(!r()(t).is(":visible")||r()(t).find(".kba-pair[index=".concat(s,"]:visible")).length)return n.answer&&n.answer.length?o.answer=n.answer:e.data.user[a]&&i.a.isObject(e.data.user[a][s])&&(o.answer=e.data.user[a][s].answer),"custom"===n.questionId?o.customQuestion=n.customQuestion:o.questionId=n.questionId,o}).compact().value()]:[a,n]}).fromPairs().value()},render:function(e,t){this.data=e,C.getInfo().then(i.a.bind(function(e){this.data.predefinedQuestions=i.a.map(e.questions,function(e,t){return{id:t,question:e}}),this.data.numberOfQuestions=e.minimumAnswersToDefine,this.parentRender(t)},this))},reloadFormData:function(){var e,t=this;this.parentRender(function(){e=t.$el.find("form")[0],l()(e,i()(u()(e,".",!1)).map(function(e,n){return i.a.isArray(t.data.user[n])?[n,i.a.map(t.data.user[n],function(e){return i.a.omit(e,"answer")})]:[n,t.data.user[n]]}).fromPairs().value()),i.a.each(r()(".kba-questions",e),function(e){var t=r()(e).closest(".kba-pair").find(".custom-question");""===t.find(":input").val()?t.toggleClass("hidden",!0):(r()(e).val("custom"),t.removeClass("hidden"))}),t.initializeChangesPending(),r()(e).find("input[type='reset']").prop("disabled",!0),r()(e).find("input[type='submit']").prop("disabled",!0)})}});t.default=new q}}]);
//# sourceMappingURL=119.23f6a14627.js.map